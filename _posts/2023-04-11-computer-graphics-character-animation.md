---
title: "[Computer Graphics] #13. 캐릭터 애니메이션"
excerpt: "한정현 컴퓨터 그래픽스 강의 13장 정리"

categories:
  - Computer Graphics
tags:
  - [Computer Graphics, graphics, cg, euler transforms, euler, quaternions]

permalink: /computer-graphics/character-animation/

toc: true
toc_sticky: true

date: 2023-04-11 18:12:03+0900
last_modified_at: 2023-04-11 18:12:07+0900
published: false
---

## 👻 캐릭터 애니메이션
그래픽스에서 애니메이션을 적용할 가장 중요한 대상은 캐릭터
특히 사람 캐릭터가 중요

캐릭터 골격과 공간 이전
캐릭터의 골격을 이용. 골격은 다수의 뼈로 구성된 관절체(Articulated body)
리깅 작업을 거쳐야함->폴리곤 메시에 스켈레톤을 붙이는 것
맥스에서는 바이페드라는 기본적인 골격을 제공한다
골격을 합치는 것은 맥스에서 기본으로 제공해준다
골격
캐릭터의 기본 자세를 드레스 포즈라 함
골격은 폴리곤 메시로 옮겨진 후, 캐릭터의 드레스 포즈에 수작업으로 맞춰짐
골격이 드레스 포즈에 맞춰지면 뼈마다 하나의 변환 행렬이 자동으로 계산됨
뼈와 공간 이전
뼈들은 계층적으로 부조-자식 관계를 형성
캐릭터 애니메이션에서는 관례적으로 골반을 루트 노드로 정함.
뼈는 관절로 연결되어 있음. 한 뼈가 움직이면 그 뼈에 속한 정점도 움직임. 이 정점은 ㄱ뼈의 오브젝트 공간에 정의해야함
캐릭터 메시의 모든 정점이 정의되어 있는 공간을 캐릭터 공간이라 부름
뼈의 오브젝트 공간은 뼈 공간
캐릭터 공간에서 정의된 정점이라도 뼈 공간으로 변환되면 좌표가 달라짐
이 변환의 역을 취하면 뼈 공간에서 캐릭터 공간으로의 변환이 가능
한 뼈에 속한 정점을 그 부모의 뼈 공간으로 변환하는 것을 부모 변환
부모 좌표계를 자식 좌표계에 포개는 행렬과 같음
골격을 구성하는 각 뼈는 고유의 길이를 갖고 있으며, 자신의 뼈 공간의 x축을 따라 놓이는 것이 관례임
한 벼의 정점이 주어졌을 때 부모 변환 행렬을 계속 결합하면 골격 계층 구조의 어떤 조상이든지 그것의 뼈 공간으로 정점을 변환할 수 있음.
캐릭터 공간에서 뼈 공간으로의 변환
골반은 루트 노드이므로 골반 공간은 캐릭터 공간과 동일하다고 간주하면 이 아이의 변환 행렬은 단위 행렬이다

정기구학
관절체 애니메이션이 완료된 정점을 렌더링에 사용하기 위해서는 이를 다시 캐릭터 공간으로 변환해야 한다. 이렇게 해야 애니메이션 포즈의 캐릭터 전체가 gpu 파이프라인을 따라 월드 변환, 뷰 변환 등을 거쳐 최종적으로 스크린에 렌더링 된다.
애니메이션 적용->그 결과를 캐릭터 공간으로 옮기는 변환
일부분만 변환되면 지역 변환이라고 함
기구학은 질량이나 힘을 고려하지 않고 물체의 움직임을 기술하는 학문 분야이다.
모든 뼈의 변환을 계산하여 관절체 전체의 모습을 결정하는 것을 정기구학이라고 부른다.
반대는 역기구학

스키닝
캐릭터의 폴리곤 메시를 피부라고도 부름
골격 움직임에 따라 어떻게 피부를 부드럽게 변형하는지?
뼈가 한 정점에 영향을 주도록 하고 그 결과를 블렌딩하면 부드럽게 피부를 만들 수 있음
각 뼈가 한 정점에 얼마나 영향을 주는지 정하는 것을 블렌딩 가중치
가중치를 이용해 선형보간
이러한 기법을 스키닝 혹은 정점 블렌딩이라 부름
일반적으로, 한 정점에 영향을 주는 뼈들과 그 가중치는 애니메이션 과정 전체에 걸쳐 일정하게 유지되는데, m개의 뼈가 한 정점에 영향을 준다고 가정하자.
게임과 같은 실시간 그래픽스 응용에서는 대체로 m으,ㄴ 4로 고정된다. 물론 m 개의 뼈의 가중치 합은 1이다
매 프레임마다 골격의 모든 뼈의 행렬이 갱신된다. 이는 행렬 팔레트라 불리는 테이블에 저장된다
일반적으로 스키닝 알고리즘은 정점 쉐이더로 구현된다.
정점 쉐이더에게 행렬 팔레트는 유니폼으로 제공된다
팔레트 인덱스와 블렌딩 가중치는 정점 위치, 노멀, 텍스처 좌표 등과 함께 정점 배열에 저장된다
ㄴ> 애트리뷰트로 제공됨
키프레임 애니메이션에서의 스키닝
중간 프레임은 보간하여 사용될 것(변환)
특별한 경우가 아니면 회전 행렬고 국한된다(사람의 관절은 회전만 가능)
따라서 변환은 강체 변환.
키프레임에서 각각의 벼에는 R이 쿼터니언으,로 변환되어 저장되고 t는 3차원 벡터로 저장됨
이것이 바로 뼈ㅑ의 키 데이터를 구성

역기구학
로봇 팔의 끝에 부착되어 물체를 잡고 다루는 등의 용도로 쓰이는 기구를 말단 장치라 한다.
정기구학은 로봇 팔의 관절 각도를 입력으로 받아 말단 장치의 위치 및 방향을 결정한다.
이러한 작업의 역순을 역기구학이라고 함.(IK:inverse kinematics)
목표로 하는 말단 장치의 위치 및 방향이 입력으로 주어지면, 이 목표를 달성하기 위해 필요한 각 관절의 각도를 계산한다.
자연스러운 애니메이션 구현이 가능
로봇 분야에서는 복잡한 계산 과정을 거치지만 실시간 응용 분야에서는 간단한 알고리즘이 사용됨
두 가지 기법소개
해석적 기법
물체의 상태를 정의하는 독립적인 변수의 개수를 자유도라 부름
로봇 팔꿈치는 위아래로만 움직이기 가능: 1자유도 관절
어깨는 기구학적으로 볼 조인트와 같음
좌우, 위아래: 자유도 2
위팔은 회전가능:자유도 3
즉 어깨는 3
IK는 회전시키는데 필요한 각 부위의 관절각을 계산
CCD 알고리즘
해석적 기법은 빠르고 정확하게 IK를 해결할 수 있지만 많은 관절을 가진 복잡한 관절체에는 사용하기 어렵다.
대안으로 종종 ccd 알고리즘이 채택된다
말단 장치로부터 시작해 계층 구조를 거슬러 올라가며 말단 장치와 목표 지점 간 거리가 최소화되도록 관절각을 조정하는 기법
거리가 임계값 이상 벌어지면 작업 반복


***

## 👻 글을 마치며


***

_출처_   
_[한정현 컴퓨터 그래픽스 강의 (13장-캐릭터 애니메이션)](https://youtu.be/aZcrHIDO5zY)_   
_[도서 관련 예제 GitHub](https://github.com/medialab-ku/openGLESbook)_   
_[PPT 강의 자료 및 사진 출처](https://media.korea.ac.kr/books/)_

_관련 도서_   
_OpenGL ES를 이용한 3차원 컴퓨터 그래픽스 입문 - 한정현 지음_   