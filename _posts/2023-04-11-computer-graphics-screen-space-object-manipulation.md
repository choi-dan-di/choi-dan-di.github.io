---
title: "[Computer Graphics] #12. 스크린 물체 조작"
excerpt: "한정현 컴퓨터 그래픽스 강의 12장 정리"

categories:
  - Computer Graphics
tags:
  - [Computer Graphics, graphics, cg, screen space, object manipulation]

permalink: /computer-graphics/screen-space-object-manipulation/

toc: true
toc_sticky: true

date: 2023-04-11 00:35:07+0900
last_modified_at: 2023-04-11 00:35:11+0900
published: false
---

## 👻 스크린 물체 조작
12장. 스크린 물체 조작
렌더링된 물체 선택->피킹
피킹 시에 얻을 수 있는 정보는 스크린 상에서 손가락 혹은 마우스로 선택한 점의 2차원 좌표
이 좌표를 사용해서 해당 위치의 물체를 찾아내는 기법
-스크린 공간 광선
광선을 정의하여 이 광선에 의해 처음 부딪히는 물체가 선택될 것. z축으로 뻗어나감
direction vector (0, 0, 1)
광선-0물체 교차 검사를 수행
스크린 공간에서는 수행 x -> 물체(오브젝트)에 관한 정보가 없기 때문ㅇ
이 광선을 오브젝트 공간까지 변환하여 검사 수행
카메라 공간에서 start point의 z좌표는 무조건 -n이다. (전방 평면)
스크린 -> 카메라->오브젝트
역순으로 행렬 연산
1. 투영 행렬 연산
카메라 공간의 시작점에 적용하면 클립 공간의 시작점을 얻게 된다.
마찬가지로 뷰포트 변환을 적용하면 뷰포트의 시작점을 얻게 된다.
뷰포트의 시작점은 알고 있기 때문에 거슬러 올라가면 카메라 공간의 시작점의 x, y를 알 수 있다.
2. 방향 벡터 계산
카메라 공간에서의 방향 벡터는 하나의 projection line이다. 반대로 쭉 이으면 원점으로 수렴할 것이다.
이 것을 이용하면 ㅂ캄[ㅔ라 공간에서의 방향 벡터를 구할 수 있따.]
원점과 시작점을 잇는다.
ㄴ>카메라 공간 광선을 뒤로 늘이면 원점이 닿음
원점과 광선의 시작점을 연결한 벡터가 방향 벡터
마지막 원소가 0이면 벡터, 1이면 점(좌표)
->스크린 공간 광선의 방향 벡터

오브젝트 공간 광선
카메라 공간 광선->월드 공간->오브젝트 공간
월드 공간으로의 변환은 뷰 변환의 역변환
M-1은 T-1R-1ㅇ;ㅣ 된다
각자 오브젝트에 월드변환의 역변환을 하면 오브젝트 공간까지 갈 수 있따.
월드변환->아핀변환?..
<Q&A> 하나의 월드공간레이가 오브젝트 수만큼 생김

광선과 바운딩 볼륨 간 교차 검사
광선-삼각형 교차 검사 실시
충돌 여부 판별
메시의 삼각형 수 만큼 부딪혔는지 검사해야함
->정확하지 않더라도 빠른 방법이 없을까? -0> 바운딩 볼륨(BV)
각 메시를 완벽히 감싸는 바운딩 볼륨을 구한 뒤 이를 광선과의 교차 검사에 사용
가장 많이 쓰이는 두 가지 box, sphere
직육면체 AABB (xyz축과 나란함)
Xmin, Xmax, Ymin, Ymax, Zmin, Zmax를 구하여 지정함. 구하는 방법은 모든 정점을 순회하면서 다 넣고 비교하면서 세팅함. 초기화 가장 첫 정점의 값으로 모두 세팅
구는 바운딩 구
바운딩 구를 얻는 가장 단순한 방법은 AABB를 구하는 것
aabb의 대각선의 중심을 구해서 중점, 길이를 반지름으로 설정->타이트하지 않음, 너무 큼
ㄴ>딱 맞는 스피어는 타이탄 스피어. 타이탄 스피어를 구하고싶은데 이건 알고리즘이 따로 있음
3차원으로 확장 가능
a, b, c도 모두 아는 수(구의 중점과 반지름도 알고 오브젝트 공간의 레이의 시작점, 방향 벡터도 모두 앎)
판별식으로 부딪혔는지 확인
근이 두개면 들어갈 때 나올 때 총 두번 부딪힘
근이 하나면 중근, 접함
판별식 음수면 부딪히지 않음
광선과 처음으로 교차하는 물체로 선택
여러 개일 때(여러 개의 물체가 선택될 때에는) 작은 수를 구하면 됨.(처음 접하는 부분)
그러면 앞에 있는 물체가 선택되겠지?(???이해가 안 가는데 갑자기?->이해함 구가 축소되면서 이해가 안갔었는데..암튼 감..)
종종 부정확함
정확한 계산은 반드시 폴리곤 메시의 모든 삼각형과 광선 간 교차 검사를 수행
그럴 경우라도 ray-bv는 전처리 단계에서 실행해야함 
실제 그래픽스 응용 시엔 계층적인 바운딩 볼륨을 많이 쓴다. 예를 들어 머리따로 목따로 팔따로 등등

<Q&A>이 과정은 cpu 프로그램 단계에서 설정해줘야함

광선과 삼각형 간 교차검사
삼각형 개수만큼 검사함
p는 세 정점의 가중치 합으로 정의
(u, v, w)는 p의 무게중심 좌표라고 함 barycentric coordinates (u, v, w)
p = ua + vb + wc
u, v, w
u+v+w = 1
u, v만으로도 표현 가능(1-u-v)c
크레이머 법칙으로 풀이 가능
행렬식임
분모 dAB
분자 SAB
각 위치에 맞게 우항으로 변환
(Q.행렬식은 정해져있는건가?)
교차점을 찾으려고 하는건 아니고 더 중요한 건 p가 삼각형 내부에 있다는 것이 보장이 되는걸까?
p가 모두 양수면 삼각형 안에 있지만 음수가 하나라도 있으면 외부이다.
=> 삼각형이랑 한게 아니고 연장된 평면과 했기 때문. -> 모두 양수면 내부에 존재 하나라도 0이면 선분에서 만남
모두 양수고 p가 내부에 있으면 이제 t를 구해서 값을 구함
물론 여러개일 수도 있음. -> 여기서 이제 가장 작은 t를 구하면 됨

Rotating an Object
피킹 한 오브젝트를 회전하고 싶을 때
모바일 기기 같은 경우 터치해서 돌리면 물체가 돌아가는 것.

Arcball
회전을 시킬 대상을 하나의 구가 감싸고 있다고 가정하자. 스크린에서 터치한 후 움직이면 그 공이 움직이게 되는 것
이 공을 아크볼이라고 한다. 실제로 존재하는 구는 아님
종횡비가 1:1이 아니면 럭비공같은 구가 만들어질것이다. -> 그 전에 가로세로 2가 되도록 정규화 시켜야함
스크린의 좌표는 정중앙에 와있음
반지름이 1인 구를 만들고 싶고 중점을 원점에 놓고 싶어서
스크린이 아니라 점들을 정규화시키고 싶은 것
(Q. 아크볼에서 vz공식이 이해가 안 가ㄱ요 ㅠ)
아크볼 표면에 투영하지 않는 경우, q를 먼저 3차원 좌표계의 xy평면으로 1차 투영하고 정규화하면 아크볼 표면으로 2차 투영된다.(왜냐? 아크볼 반지름은 1이니까)

3차원 회전ㄴ이기 때문에 회전 축과 angle이 필요함
회전축은 vi와 vi+1의 벡터곱으로 구할 수 있음 -> 순서 바꾸면 반대 방향으로 회전 됨
vi와 vi+1을 내적하면? 회전각을 얻을 수 있따.

회전을 하면 하는 즉시 렌더링 되어야함->회전 축을 그냥 카메라 공간에서 정의된 걸로 트릭을 걸자
-> 아크볼에서 정의된 3차원 회전축을 ㅋ카메라 공간으로 그대로 옮기자
회전각은 그대로 가져오면 됨
1. 행렬로 표현해야 렌더링 파이플아ㅣㄴ에 넣을 수 잇ㅇ므
glm쓰기(opengl math library) glm::rotate(angle, axis)
직접 만들고 싶으면 앞에서 배운 오일러 변환이랑 쿼터니언 이용하면 됨
2. 월드 변환 전에 적용
저 행렬을 R1이라고 할 때 MR1을 마치 월드 변환인 것처럼 적용하면 내 손가락이 움직인 궤적을 따라 물체가 회전할 것이다
뒤에 회전이 또 있어도 또 똑같이 하면됨 R2 그러면 MR1R2
M이 월드




클립 공간까지 변환시킨 다음 래스터라이저 단계 후 라이팅




***

## 👻 글을 마치며


***

_출처_   
_[한정현 컴퓨터 그래픽스 강의 (12장-스크린 물체 조작)](https://youtu.be/c7la2Tt_cOc)_   
_[도서 관련 예제 GitHub](https://github.com/medialab-ku/openGLESbook)_   
_[PPT 강의 자료 및 사진 출처](https://media.korea.ac.kr/books/)_

_관련 도서_   
_OpenGL ES를 이용한 3차원 컴퓨터 그래픽스 입문 - 한정현 지음_   