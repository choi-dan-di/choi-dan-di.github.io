---
title: "[C++] μ¤λ§νΈ ν¬μΈν„°(Smart Pointer)"
excerpt: "μ¤λ§νΈ ν¬μΈν„°μ— λ€ν•΄ μ•μ•„λ³΄κΈ°"

categories:
  - C/C++
tags:
  - [C/C++, C++, Visual Studio, modern cpp, modern, smart pointer, pointer, smart]

permalink: /cpp/smart-pointer/

toc: true
toc_sticky: true

date: 2022-12-18 23:28:46+0900
last_modified_at: 2022-12-18 23:28:48+0900
---

## π‘» μ¤λ§νΈ ν¬μΈν„°
**μ¤λ§νΈ ν¬μΈν„°(Smart Pointer)**λ” **ν¬μΈν„°λ¥Ό μ•λ§μ€ μ •μ±…μ— λ”°λΌ κ΄€λ¦¬ν•λ” κ°μ²΄**λ¥Ό μλ―Έν•λ©° ν¬μΈν„°λ¥Ό λν•‘ν•΄μ„ μ‚¬μ©ν•λ‹¤. μ°λ¦¬κ°€ μ΄μ κ» λ°°μ›μ™”λ μΌλ° ν¬μΈν„°λ” λ¬Όλ΅  μ μ‚¬μ©ν•λ©΄ νΈλ¦¬ν•κ² μ‚¬μ©ν•  μ μμ§€λ§ **μ—‰λ±ν• λ©”λ¨λ¦¬λ¥Ό κ±΄λ“λ¦΄ μλ„ μλ‹¤λ” μ„ν—μ„±**μ΄ μ΅΄μ¬ν•λ‹¤. μ΄λ¬ν• μ‹¤μλ” ν• λ²λ§ ν•΄λ„ ν”„λ΅κ·Έλ¨μ΄ λ»—λ” μΉλ…μ μΈ κ²°κ³Όλ¥Ό λ‚³κ²λλ‹¤. μ΄λ¬ν• μΌλ“¤μ„ λ°©μ§€ν•κΈ° μ„ν•΄μ„ μ¤λ§νΈ ν¬μΈν„°λ¥Ό μ‚¬μ©ν•λ” κ²ƒμ΄ μΆ‹λ‹¤.

μ¤λ§νΈ ν¬μΈν„°μ—λ” ``` shared_ptr ```, ``` weak_ptr ```, ``` unique_ptr ```κ°€ μλ‹¤.

***

### π± shared_ptr
``` shared_ptr ```λ” **μ°Έμ΅° μ •λ³΄λ¥Ό κ΄€λ¦¬ν•κ³  κ°μ²΄μ μƒλ… μ£ΌκΈ°λ¥Ό μλ™μΌλ΅ κ΄€λ¦¬**ν•΄μ£Όλ” ν¬μΈν„°μ΄λ‹¤. μ°Έμ΅° μΉ΄μ΄νΈλ¥Ό κ΄€λ¦¬ν•λ©° ν•΄λ‹Ή ν¬μΈν„°κ°€ κ°€λ¦¬ν‚¤λ” κ°μ²΄λ¥Ό λ‹¤λ¥Έ ν¬μΈν„°λ“¤μ΄ μ–Όλ§λ‚ μ°Έμ΅°ν•κ³  μλ”μ§€ ν™•μΈν•κΈ° μ„ν• μ©λ„λ΅ μΉ΄μ΄νΈ μ •λ³΄λ¥Ό λ‹΄κ³  μλ‹¤. μ°Έμ΅° μΉ΄μ΄νΈκ°€ 0μ΄ λλ©΄ λ©”λ¨λ¦¬ ν•΄μ λ¥Ό κ³ λ ¤ν•λ‹¤.

```c++
shared_ptr<Knight> k = make_shared<Knight>();
```

> - ``` make_shared ```
    - λ©”λ¨λ¦¬ λΈ”λ΅μ„ ν• λ²μ— λ§λ“¤μ–΄μ¤μ„ ``` new ```λ΅ ν•λ” κ°μ²΄ μƒμ„±λ³΄λ‹¤ ν›¨μ”¬ μ„±λ¥μ΄ μΆ‹λ‹¤.
    - ``` k(new Knight()) ```μ™€ κ°™μ€ μλ―Έμ΄λ‹¤.

ν•΄λ‹Ή ν¬μΈν„°λ¥Ό μ‚¬μ©ν•λ©΄ λ²”μ„κ°€ μ‘μ•„ μ›λλΌλ©΄ μ†λ©Έλ  κ°μ²΄λ„ λ„κµ°κ°€κ°€ μ°Έμ΅°λ¥Ό ν•κ³  μλ‹¤λ©΄ μ†λ©Έλμ§€ μ•λ” νΉμ§•μ΄ μλ‹¤. λ‹¨, μ‚¬μ΄ν΄ λ°μƒμ‹ μ‚­μ κ°€ λμ§€ μ•λ” λ¬Έμ κ°€ λ°μƒν•κ² λλ‹¤.

```c++
shared_ptr<Knight> k5 = make_shared<Knight>();
{
    shared_ptr<Knight> k6 = make_shared<Knight>();
    k5->_target = k6;
    k6->_target = k5;    // μ‚¬μ΄ν΄ λ°μƒμ‹ μ‚­μ κ°€ λμ§€ μ•λ” λ¬Έμ  λ°μƒ
    
    // μ†λ©Έ μ „μ— nullptrλ΅ λ°€μ–΄μ£Όλ” λ¶€λ¶„μ΄ ν•„μ”ν•λ‹¤.
    k5->_target = nullptr;
    k6->_target = nullptr;
}
```

***

### π± weak_ptr
``` weak_ptr ```λ” μ„μ—μ„ λ³Έ ``` shared_ptr ```μ λ‹¨μ μ„ λ³΄μ™„ν•΄μ£Όλ” ν¬μΈν„°μ΄λ‹¤. κ°μ²΄κ°€ λ‚ λΌκ°”λ”μ§€ μ λ¬΄λ¥Ό ν™•μΈν•κ² λκ³  κ²½μ°μ— λ”°λΌ ``` shared_ptr ```λ¥Ό λ°ν™ν•΄μ¤μ„ μ‚¬μ΄ν΄ λ°μƒ κ°™μ€ λ¬Έμ λ¥Ό λ§‰μ•„μ¤„ μ μλ‹¤.

```c++
// weak_ptr
void Attack() {
    if (_target.expired() == false) {
        shared_ptr<Knight> sptr = _target.lock();

        sptr->_hp -= _damage;
        cout << "HP : " << sptr->_hp << endl;
    }
}
```

> - **expired** : ν•΄λ‹Ή κ°μ²΄κ°€ λ‚ λΌκ°”λ”μ§€ ν™•μΈ. μ•„μ§ μμΌλ©΄ ``` false ```λ¥Ό λ°ν™ν•λ‹¤.
- **lock** : ν•΄λ‹Ή κ°μ²΄μ ``` shared_ptr ``` νƒ€μ…μ„ λ°ν™ν•λ‹¤.

***

### π± unique_ptr
``` unique_ptr ```λ” λ§ κ·Έλ€λ΅ ν• κ°μ²΄λ¥Ό μ¤λ΅μ§€ μκΈ° μμ‹ λ§ κ°€λ¦¬ν‚¤κ³  μμ–΄μ•Ό ν•λ” ν¬μΈν„°μ΄λ‹¤. μ¤‘λ³µμΌλ΅ κ°€λ¦¬ν‚¤λ” κ±΄ λ¶κ°€λ¥ν•λ‚ μ¤λ¥Έκ°’ μ°Έμ΅°λ¥Ό μ΄μ©ν•΄ μ΄λ™ μ—°μ‚°μ€ κ°€λ¥ν•λ‹¤.

```c++
unique_ptr<Knight> uptr = make_unique<Knight>();
// unique_ptr<Knight> uptr2 = uptr; // λ¶κ°€λ¥
unique_ptr<Knight> uptr2 = move(uptr);  // μ¤λ¥Έκ°’ μ°Έμ΅° μΊμ¤ν…
```

***

## π‘» κΈ€μ„ λ§μΉλ©°
μ΄λ² μ‹κ°„μ—λ” μ¤λ§νΈ ν¬μΈν„°μ— λ€ν•΄ μ•μ•„λ³΄μ•λ‹¤. μ΄λ¬ν• λ¬Έλ²•μ΄ μλ”μ§€λ„ λ°λλ”λ°.. μ‚¬μ© λ°©λ²•λ§ μµμ™ν•΄μ§€λ©΄ μ”κΈ΄ν•κ² μ μ“Έ μ μμ„ κ²ƒ κ°™λ‹¤. μ²μμ—” shared_ptrμ μ°Έμ΅° μΉ΄μ΄ν„° κ³„μ‚°λ²•μ΄ μ™€λ‹Ώμ§€ μ•μ•„μ„ κ³ λ―Όμ„ λ§μ΄ ν–μ—λ”λ° λ‹¨μν•κ² ν¬μΈν„° μƒμ„±μ‹ 1λ¶€ν„° μ‹μ‘ν•λ‹¤κ³  μƒκ°ν•λ©΄ κ·Έλ‚λ§ μ΄ν•΄κ°€ κ°€λ” κ²ƒ κ°™λ‹¤.

***

_[μ†μ¤μ½”λ“ λ³΄λ¬κ°€κΈ°](https://github.com/choi-dan-di/study_cpp/tree/main/modern-cpp/smart-pointer)_

***

_μ¶μ²_   
_[μΈν”„λ° Rookiesλ‹ κ°•μ](https://inf.run/bje8)_   